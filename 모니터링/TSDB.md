
OpenTSDB
https://docs.victoriametrics.com/

두가지 모니터링 시스템
![[Pasted image 20240616151124.png]]

기존의 블로그 카페등 별로 없음
=> 뭐가 많아짐 200개가 넘어감 검색만

베어메탈의  cpu, 쿼리 카운트 지표 시스템
시스템이 문제가 된것 => 발전하면서 서버한대를  MSA가 들어가면서 서버 한대의 지표가 나타내지 않는다
서비스 별로 통합된 데이터를 봐야한다!! => 새롭게 구조 aggregation 된 데이터 따로 저장

기존 SQL -> NOsql에 넣어서 대시보드를 보았다
![[Pasted image 20240616151422.png]]

![[Pasted image 20240616151431.png]]
서버하나가 서비스를 대표하지 못한다!! 합쳐서 봐야한다 -> 메트릭 종류가 다양해진다
서비스에서만 나오는것도 봐야한다. 시스템에서의 메트릭만

쿼리하나에 - 몇십개의 로그가 찍힌다
 - 어떤 쿼리, AB테스트, 광고서비스, 시스템 개선 로그들도 찍어야한다!
 - 통합을 거쳐서 여러개의 -> 블로그, 카페 , 지식인 검색 문서를 올라가야한다! 수십개가 찍혀야한다!
 - 초당 쿼리카운트가 2000개면 로그가 20개라고 하면 => 초당 4만개의 로그가 찍힌다 => 60초라면 240만개 => Raw를 뒤져서 뽑아서 메트릭을 저장해야한다
 - 240만 로우를 뒤져서 메트릭 1분 계산! => 너무 많다. => 디스크, 컴퓨팅 파워에서 낭비가 된다 
 - Aggregation해서 볼 수 있는? 모니터링 시스템 운영

기존 로우 + aggregated데이터까지 모으면 컴퓨팅, 디스크 파워가 더 낭비되는것이 아닌가?

컬럼 하나 추가에 몇시간 -> ALter 문에서 컬럼 추가 => 락이 걸린다. 디비를 교체를 해야한다, or 멀티 마스터로 잡아서 뭐 해야함 -> 시간이 오래 걸린다!
두번째는 RDB에다가 저장하고 Aggregationi 데이터 사라짐 -> 실시간성 없음
![[Pasted image 20240616152203.png]]

![[Pasted image 20240616152355.png]]

=> QPS전체 알려줘! -> 부하 개심해짐

프로메테우스 - 단일 운용이 제일 가능하기 때문에 - 한대 Single point of Failure 
방지 하기 위해서 프로메테우스에 호환되는 것이 - thanos! 라는 솔루션이다!
프로테우스를 모니터링 하는 프로메테우스
