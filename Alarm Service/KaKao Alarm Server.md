# 알림 서비스로 시작하는 서버 개발 / if(kakao)2022
- Link: https://www.youtube.com/watch?v=CmTO68I2HSc

1. 간단하 아키텍처
![[Pasted image 20240616215232.png]]

단점: 알림 생성에 부하가 생길시 두개의 서비스가 모두 작동하지 않는다

2. 고로 서버 분리한다
![[스크린샷 2024-06-16 오후 9.53.30.png]]

3. 하지만 여전히 연계시스템에 오류가 발생할 수 있다
![[스크린샷 2024-06-16 오후 9.53.56.png]]
- 예를 들어 이체 서비스가 이체 알림 때문에 작동을 안한다 느김

4. 생성서버를 비동기로 요청해야한다
![[Pasted image 20240616215448.png]]
- 알림 요청 그룹은 상관이 없다
- 비동기를 통해 빠른 응답 + 연계 안됨
- 하지만 알림이 정상적으로 만들어졌는지 알 수가 없다
- 또한 실시간으로 알려주지 못하고 약간의 지연이 존재한다!
- 지연에 대한 모니터링 해야한다

5. 생성서버가 다운되거나 재시작 되면 알림을 유실하여 보장할 수 없다!

6. 메세지 큐를 도입한다
![[Pasted image 20240616215603.png]]

![[Pasted image 20240616215623.png]]
- 메세지큐도 비동기성이므로 비동기 방식 유지

Consumer에 장애가 발생하면?
- 연계시스템 
- conusmer가 ack를 안보내서 재처리를 시도한다

메세지 큐가 장애가 발생하면?
- 자기 이벤트들을 디스크에 저장하기때문에 디스크에서 가져와서 작업을 한다. 인큐를 못하면 디비에 요청을 저장한다

![[스크린샷 2024-06-16 오후 9.58.19.png]]

그렇다면 위의 내용을 어떻게 나의 서비스에 적용할 수 있을까?
1. 알림서비스를 도입할 것이다
2. 알림서비스가 왜 필요한것인가?
	1. 메메라는 서비스를 예로 들어보자!
	2. 메이크업 예약을 요청하고 아티스트가 허락을 했다면 사용자에게 알림이 확정되었다고 응답을 보내야한다!
	3. 모니터링시 에러가 나면 슬랙에 알림을 보내야한다
	4. 모모서비스
		1. 게시글에 답변이 달릴때
		2. 채택이 될때
		3. 등등
3. 모모 예시
	1. 게시글 답변 기능에서 카프카로 실어서 보낸다 - Producer
	2. 알림생성서버에서 Consume한다
	3. 데이터베이스에 저장
	4. 알림 조회시 데이터베이스 접근해서 가져온다!
	- 라는 시나리오로 접근한다
	- 추가적인 해드폰 알림 보내기 서비스에서는 토큰 FCB? Apple Token등을 이용해야하는데 프론트가 구축이 된다면 그때 적용을 해봐야할듯? 일단 백엔드에서 가능하게끔 사용해보자!

